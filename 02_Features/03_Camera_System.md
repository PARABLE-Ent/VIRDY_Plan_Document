# 카메라 시스템

> **문서 버전**: 1.0
> **최종 수정일**: 26.01.30 13:20
> **작성자**: 임경섭

---

## 1. 개요

카메라 시스템은 VIRDY의 가상 방송 환경에서 촬영, 모니터링, 방송 출력을 담당한다. 10개 채널의 가상 카메라를 운영하며, 4가지 View 모드와 Channel Link를 통해 개인 크리에이터부터 프로덕션 스튜디오까지 다양한 워크플로우를 지원한다.

---

## 2. 핵심 기획

### 2.1 10채널 가상 카메라 구조

| 채널 | 이름 | 타입 | 설명 |
|------|------|------|------|
| 0 | Free CAM | 자유 카메라 | WASD + 마우스로 자유 이동, 프리셋 저장 불가 |
| 1~9 | CAM 01 ~ CAM 09 | 고정 카메라 | Transform 프리셋 저장 가능, Channel Link 가능 |

#### 카메라별 저장 데이터

| 데이터 | 설명 |
|--------|------|
| Position | 카메라 위치 (3D 좌표) |
| Rotation | 카메라 회전 (Euler 각도) |
| Focal Length | 초점 거리 (줌) |
| 카메라 설정 | DOF, Follow, LookAt 등 |

### 2.2 카메라 모드

#### FreeCam (자유 카메라)

| 조작 | 키 | 설명 |
|------|-----|------|
| 기본 이동 | W / A / S / D | 카메라 앞/뒤/좌/우 이동 |
| 상승/하강 | Q / E | 카메라 상하 이동 |
| 빠른 이동 | Shift | 카메라 이동 속도 증가 |
| 시점 회전 | 마우스 우클릭 드래그 | 카메라 방향 변경 |
| 줌 | 마우스 휠 | Focal Length 조절 |

조절 가능한 설정:

| 설정 | 설명 |
|------|------|
| 카메라 속도 | 이동 속도 |
| 줌 속도 | 마우스 휠 민감도 |
| 회전 민감도 | 마우스 드래그 민감도 |

#### Fixed Camera (고정 카메라)

| 기능 | 설명 |
|------|------|
| 카메라 위치 저장/로드 | Transform을 저장하고 불러오기 |
| Channel Link | 다른 유저에게 카메라 뷰 공유 |
| Spectator 미리보기 | 9개 카메라 동시 미리보기 |
| 전체 카메라 저장/로드 | 모든 카메라 로컬 저장 및 불러오기 (월드 재접속, 변경시 사용)

### 2.3 View 모드

4가지 View 모드를 제공하여 다양한 상황에 맞는 화면 구성을 지원한다.

| 모드 | 화면 구성 | 용도 |
|------|----------|------|
| **Default** | Main Screen만 표시 | 일반 방송 (개인 크리에이터, 화면녹화) |
| **Manager** | Main + Sub + Spectator (9분할) | 제작/매니저 모드 |
| **Studio** | 9분할 모니터링 화면 | 스튜디오 모니터링 |
| **Spout** | Spout 텍스처 출력 | OBS 연동 방송 송출 |

#### Default 모드

- Main Screen 단일 화면
- 가장 기본적인 방송 화면 구성

#### Manager 모드

| 영역 | 설명 |
|------|------|
| Main Screen | 메인 송출 화면 |
| Spectator View | CAM 01~09의 9분할 미리보기 |
| Manager CAM | 자유롭게 조작하는 FreeCam |

#### Studio 모드

- 9분할 화면으로 CAM 01~09를 동시 모니터링
- 스튜디오 환경에서 다수 카메라를 한 눈에 확인
- 메모리/GPU 최적화: 모니터링 카메라 해상도 / 프레임 다운그레이드 기능 제공

#### Spout 모드

| 항목 | 설명 |
|------|------|
| 출력 경로 | VIRDY → Spout Sender → OBS (Spout2 Source) |
| 출력 내용 | Main Screen만 전송 (UI 제외) |
| 장점 | GPU 메모리 직접 공유로 저지연, 채팅 등 UI가 방송에 포함되지 않음 |
| 해상도 | 설정에 따라 조절 가능 |

### 2.4 Channel Link 시스템

Channel Link는 멀티유저 환경에서 다른 유저의 카메라 뷰를 주고받는 기능이다.

#### 연결 모드

| 모드 | 설명 |
|------|------|
| 없음 (None) | Channel Link 미사용 |
| 송출 (Sending) | 내 카메라 뷰를 다른 유저에게 전송 |
| 수신 (Receiving) | 다른 유저의 카메라 뷰를 수신 |

#### 연결 제약

| 항목 | 제한 |
|------|------|
| 최대 송출 대상 | 제한 없음 |
| 이중 공유 | 불가 (A→B→C 형태 차단) |

#### PD 워크플로우 (프로덕션)

Channel Link를 활용한 전형적인 프로덕션 구성:

| 역할 | 동작 |
|------|------|
| 카메라맨 B | CAM 1~3 촬영 → PD의 1~3 고정 카메라에 Send |
| 카메라맨 C | CAM 1~3 촬영 → PD의 4~6 고정 카메라에 Send |
| 카메라맨 D | CAM 1~3 촬영 → PD의 7~9 고정 카메라에 Send |
| PD (A) | 9개 채널 Receive → Main Screen에 카메라 스위칭 (R+1~9) |
| 방송 송출 | PD의 Main Screen → Creator의 Main Screen으로 Send → Creator의 Main Screen을 방송 송출 (OBS Game Capture 혹은 Spout2) |

### 2.5 카메라 설정

#### 기본 설정

| 항목 | 설명 |
|------|------|
| 카메라 속도 | FreeCam 이동 속도 |
| 줌 속도 | 마우스 휠 민감도 및 Z, C 세기 |
| 회전 민감도 | 마우스 드래그 민감도 |

#### 렌즈 설정

| 항목 | 범위 | 설명 |
|------|------|------|
| 초점 거리 (Focal Length) | 20~200mm | 줌 레벨 |
| 조리개 (Aperture) | 조절 가능 | 배경 흐림 정도 영향 |

#### 포커스 설정 (DoF)

| 항목 | 설명 |
|------|------|
| 포커스 사용 | 피사계 심도 활성화/비활성화 |
| 포커스 심도 | DoF 블러 강도 |
| 자동 포커스 대상 | 특정 Actor를 선택하여 자동 초점 |

#### Follow / LookAt 설정

| 항목 | 설명 |
|------|------|
| Follow 대상 | 카메라가 따라가는 대상 Actor |
| LookAt 대상 | 카메라가 바라보는 대상 Actor |
| LookAt Offset Y | 바라보기 대상의 Y축 오프셋 (높이 조절) |

### 2.6 카메라 단축키

| 키 | 동작 |
|-----|------|
| 1~9 | 해당 번호 카메라로 Main Screen 전환 |
| R | FreeCam으로 전환 |
| W/A/S/D | FreeCam 전후좌우 이동 |
| Q/E | FreeCam 상승/하강 |
| Shift | FreeCam 빠른 이동 |
| 마우스 드래그 | 시점 회전 |
| 마우스 휠 | 줌 인/아웃 |
| V | 장면 크로스페이드 On/Off (전환 애니메이션) |

### 2.7 카메라 전환 및 블렌딩

카메라 전환 시 크로스페이드 블렌딩을 지원한다.

| 항목 | 설명 |
|------|------|
| 전환 옵션 사용 | V (On/Off) |
| 블렌딩 | 부드러운 카메라 전환 애니메이션 |

### 2.8 네트워크 동기화

카메라 데이터는 네트워크를 통해 다른 유저에게 동기화된다.

| 동기화 대상 | 설명 |
|------------|------|
| Position | 카메라 위치 |
| Rotation | 카메라 회전 |
| Focal Length | 초점 거리 |
| Bool 설정 (3개) | DOF 등 On/Off 설정 |
| Float 설정 (6개) | 민감도, 오프셋 등 수치 설정 |

네트워크 보간(Interpolation)을 통해 카메라 움직임이 부드럽게 전달된다.

---

## 3. 설계 시 고려사항

### 3.1 Spout 출력 성능

- Spout은 GPU 메모리를 직접 공유하므로 CPU 부하가 낮음
- 해상도가 높아질수록 VRAM 사용량 증가
- OBS 측 Spout2 Source 플러그인 설치 필요
- Spout 출력할 UI 별도 문서 항목으로 분류 필요

### 3.2 Channel Link 네트워크 대역폭

- Channel Link는 카메라 Transform만 동기화 (영상 스트리밍이 아님)
- 데이터 동기화에 대한 최적화 및 압축 등 필요 (변화가 없는데도 계속 업데이트 하면 안 됨)

### 3.3 카메라 데이터 압축

- Position 및 Rotation 데이터 압축
- 네트워크 대역폭 최소화를 위한 R&D 지속 필요

### 3.4 Cinemachine 통합

- Unity Cinemachine을 활용하여 카메라 블렌딩 및 DoF 처리
- CinemachineVirtualCamera: 각 채널의 가상 카메라
- CinemachineBrain: 카메라 전환/블렌딩 제어
- CinemachineAutoDoFFocus: 자동 피사계 심도 포커스

---

## 4. 엣지 케이스 및 예외 처리

| 상황 | 대응 |
|------|------|
| 이중 Channel Link 시도 (A→B→C) | "이중 공유는 불가능합니다" 경고, 시스템 차단 |
| Channel Link 송출 중 상대방 퇴장 | 송출 자동 해제, 알림 표시 |
| Channel Link 수신 중 송출자 퇴장 | 수신 자동 해제, 내 카메라 시점으로 복귀 |
| Spout 출력 중 OBS 미실행 | 송출 데이터 무시, VIRDY 내부 동작에 영향 없음 |
| 카메라 프리셋 저장 후 월드 변경 | 프리셋은 어느 월드에서든 로드 가능. 단, 월드 구조에 따라 프리셋 불러올 시 정상적인 카메라 위치가 아닐 수 있음. |

---

## 5. 향후 확장 가능성

| 항목 | 설명 | 우선순위 |
|------|------|---------|
| **NDI 출력** | 방송 장비 연동용 NDI 프로토콜 지원 | 낮음 |
| **카메라 애니메이션** | 카메라 이동 경로를 사전 설정하여 자동 재생, 인게임 시퀀스 기능 | 낮음 |
| **카메라 프리셋 공유** | 다른 유저와 카메라 프리셋 공유 | 장기 |
| **렌즈 효과 확장** | 필름 그레인, 비네팅 등 시네마 효과 추가 | 장기 |

---

## 관련 문서

- [사용자 플로우](../01_Product/02_User_Flow.md)
- [네트워크 시스템](./05_Network_System.md)
- [사용자 역할](../03_Operations/01_User_Roles.md)
- [UI 기획](../04_Design/01_UI_Specification.md)
