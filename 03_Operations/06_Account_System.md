# 계정 시스템

> **문서 버전**: 1.1
> **최종 수정일**: 26.02.03 18:00
> **작성자**: 임경섭

---

## 1. 개요

이 문서는 VIRDY의 계정 생성, 인증, 연동, 삭제에 대한 정책을 정의한다. Steam을 포함한 외부 인증 수단과 VIRDY 내부 계정의 관계, 계정 생명주기, 데이터 귀속 정책을 명확히 한다.

> 🚧 서버 아키텍처 전환 검토(서버 개발자 회의, 2026.02)에 따라 인증 흐름이 변경될 수 있다. 전환 검토 내용은 본 문서 2.5절 참조.

---

## 2. 핵심 기획

### 2.1 계정 구조

VIRDY는 **내부 계정**과 **외부 인증 수단**을 분리하여 관리한다.

| 구분 | 역할 | 예시 |
|------|------|------|
| **VIRDY 계정** | 서비스 데이터의 소유 주체 | 아바타, 월드, 설정, 친구 목록 |
| **외부 인증 수단** | 로그인 방법 | Steam, 이메일/비밀번호, (향후) Google |

**핵심 원칙:**
- 외부 계정은 **인증 수단일 뿐**, 서비스 데이터의 소유는 VIRDY 계정에 귀속
- Steam 연동 해제, 로그인 불가 상황에서도 VIRDY 계정으로 데이터 복구 가능

### 2.2 Steam 연동

#### 최초 접속 시 자동 계정 생성

| 단계 | 동작 |
|------|------|
| 1 | Steam으로 VIRDY 최초 실행 |
| 2 | Steam ID 확인 |
| 3 | VIRDY 계정 자동 생성 |
| 4 | 저장 데이터: Steam ID, 생성 시각, 접속 지역(국가) |

#### 저장해야 하는 데이터

계정 복구 및 분쟁 해결을 위해 다음 데이터를 저장한다:

| 데이터 | 용도 |
|--------|------|
| 최초 생성 시 Steam ID | 계정 소유권 확인 |
| 최초 생성 시각 | 계정 생성 시점 증명 |
| 최초 접속 지역(국가) | 분쟁 시 참고 자료 |

#### Steam 연동 해제 시

| 상황 | 처리 |
|------|------|
| 연동 해제 요청 | VIRDY 계정은 유지, Steam 연동만 해제 |
| 연동 끊긴 계정 | 삭제 대상 아님, 복구 가능 상태 유지 |
| 재연동 | 동일 Steam ID로 재연동 가능 |

### 2.3 이메일 연동

#### 유료 결제 시 이메일 필수

| 상황 | 이메일 연동 |
|------|-----------|
| 무료 사용 (Steam만) | 선택 |
| 유료 결제/구독 | **필수** |

**이유:**
- 결제 영수증 발송
- 구독 상태 알림
- 계정 복구 수단 확보
- 법적 커뮤니케이션 채널

### 2.4 인증 방식 우선순위

| 우선순위 | 인증 방식 | 상태 |
|----------|----------|------|
| 1 | Steam 로그인 | ✅ 지원 예정 |
| 2 | 이메일/비밀번호 | ✅ 현재 지원 |
| 3 | Google OAuth | 📋 계획 |

### 2.5 인증 흐름 전환 검토 (서버 개발자 회의 기반)

> 🚧 아래 내용은 서버 개발자 회의(2026.02) 기반 검토 사항이다. 비용 및 기술적 타당성에 따라 변동될 수 있다.

서버 아키텍처 전환 시 인증 흐름이 다음과 같이 변경될 수 있다.

#### 전환 후 인증 흐름 (검토 중)

Steam → Firebase Auth → Backend JWT 방식으로 3단계 인증을 거치는 구조이다.

| 단계 | 동작 |
|------|------|
| 1 | Steam SDK로 로그인하여 Steam Token 획득 |
| 2 | Firebase Auth에 Custom Token 요청 → Firebase Token 수신 |
| 3 | Backend `/api/v1/auth/login`에 Firebase Token 전달 |
| 4 | Backend에서 Firebase Token 검증 후 JWT (Access + Refresh) 발급 |
| 5 | 신규 사용자인 경우: VIRDY Account 자동 생성 + Default Tenant 생성 + Owner 권한 부여 |

#### 전환 후 토큰 관리 (검토 중)

| 토큰 | 만료 | 용도 | 저장 위치 |
|------|------|------|----------|
| Access Token | 1시간 | API 호출 인증 (Authorization: Bearer) | 메모리 (Unity) |
| Refresh Token | 7~30일 (미확정) | Access Token 갱신 | 로컬 안전 저장소 |

#### 전환 후 계정 복구 흐름 (검토 중)

유료 구독자는 구독 전환 시 이메일 인증이 필수이므로, Steam 계정 분실 시에도 이메일 본인인증을 통해 새 Steam 계정을 연동하여 구독을 복구할 수 있다.

| 단계 | 동작 |
|------|------|
| 1 | Steam 계정 분실 발생 |
| 2 | VIRDY 복구 페이지에서 복구 요청 |
| 3 | 등록된 이메일로 본인인증 |
| 4 | 새 Steam 계정과 기존 VIRDY Account 연동 |
| 5 | 구독 및 데이터 복구 완료 |

#### 전환 후 Tenant 개념 도입 (검토 중)

| 개념 | 정의 |
|------|------|
| VIRDY Account | VIRDY 내부 계정 (사용자에게 비노출) |
| Tenant | 사용자/조직의 논리적 작업 공간 |
| Display Name | 사용자가 설정하는 표시 이름 (닉네임) |

신규 사용자 생성 시 자동으로 Default Tenant가 생성되며, 모든 에셋과 설정은 Tenant 단위로 격리된다. 향후 기업 사용자가 여러 Tenant에 소속될 수 있도록 Tenant 전환 기능을 검토 중이다.

---

## 3. 계정 생명주기

### 3.1 생성 시점

| 방법 | 동작 |
|------|------|
| Steam 첫 로그인 | VIRDY 계정 자동 생성 |
| 이메일 회원가입 | 이메일 인증 후 계정 생성 |

### 3.2 활성 상태

정상적으로 로그인하여 서비스를 사용하는 상태.

### 3.3 비활성 시점

| 조건 | 상태 |
|------|------|
| 로그인 수단 전부 끊김 | 비활성 (복구 대기) |
| 장기 미접속 | 비활성 (데이터 생명주기 정책 적용) |

### 3.4 완전 삭제 시점

| 조건 | 처리 |
|------|------|
| 유저 명시적 삭제 요청 | 즉시 접근 차단, 유예 기간 후 삭제 |
| 장기 미접속 + 구독 종료 | 데이터 생명주기 정책에 따라 삭제 |

**삭제 정책:**
- 즉시 삭제 ❌ → 일정 기간 유예 후 삭제
- 유예 기간 내 로그인 시 삭제 취소 가능
- 법적/보안 로그는 별도 보관

---

## 4. 외부 연동 생명주기

### 4.1 핵심 원칙

- 외부 계정(Steam 등)은 **인증 수단일 뿐**
- 서비스 데이터의 소유는 **VIRDY 계정**에 귀속
- 연동 해제/재연동에도 데이터는 VIRDY 계정에 유지

### 4.2 연동 상태 변화

| 상태 | 설명 | 데이터 영향 |
|------|------|-----------|
| 연동 | 외부 계정으로 로그인 가능 | 없음 |
| 연동 해제 | 해당 방법으로 로그인 불가 | 없음 (데이터 유지) |
| 재연동 | 동일 계정으로 다시 연동 | 없음 (데이터 복구) |

### 4.3 복구 시나리오

| 시나리오 | 복구 방법 |
|----------|----------|
| Steam 계정 분실 | 이메일/비밀번호로 로그인 → Steam 재연동 |
| 이메일 분실 | Steam으로 로그인 → 이메일 변경 |
| 모든 연동 끊김 | CS 문의 → 본인 확인 후 복구 |

---

## 5. 구독과 계정의 관계

### 5.1 구독 시작

| 단계 | 동작 |
|------|------|
| 1 | 이메일 연동 확인 (필수) |
| 2 | 결제 수단 등록 |
| 3 | 구독 시작 |
| 4 | 플랜에 따른 스토리지 할당 |

### 5.2 구독 중단

| 단계 | 기간 | 동작 |
|------|------|------|
| 유예 기간 | N일 | 데이터 다운로드 가능 (아바타, 월드) |
| 아카이브 | 유예 후 | 데이터 Cold Storage 이동 |
| 삭제 대기 | 6~12개월 | 로그인 시 기간 리셋 |
| 완전 삭제 | 삭제 대기 종료 | 복구 불가 |

> 상세 정책은 [데이터 생명주기](./04_Data_Lifecycle.md) 참조

---

## 6. 설계 시 고려사항

### 6.1 계정 복구 용이성

| 원칙 | 설명 |
|------|------|
| 다중 인증 수단 권장 | Steam + 이메일 연동 권장 |
| 복구 정보 저장 | 최초 생성 정보로 소유권 확인 |
| CS 복구 프로세스 | 본인 확인 절차 정의 필요 |

### 6.2 보안 고려사항

| 항목 | 설명 |
|------|------|
| Steam ID 검증 | Steam Web API로 정품 확인 |
| 이메일 인증 | Firebase Auth 이메일 인증 필수 |
| 세션 관리 | Firebase Auth 토큰 기반 |

### 6.3 법적 요구사항

| 항목 | 설명 |
|------|------|
| 개인정보 보호 | 최소한의 개인정보만 수집 |
| 계정 삭제권 | 사용자 요청 시 삭제 가능 |
| 데이터 이동권 | 사용자 데이터 내보내기 기능 검토 |

---

## 7. 엣지 케이스 및 예외 처리

| 상황 | 대응 |
|------|------|
| Steam 계정 해킹/도용 | CS 문의 → 본인 확인 → Steam 연동 해제 |
| 이메일 접근 불가 | Steam으로 로그인 → 이메일 변경 |
| 계정 삭제 후 복구 요청 | 유예 기간 내: 복구 가능 / 이후: 불가 |
| Steam VAC Ban | VIRDY 계정에 영향 없음 (별도 정책 검토) |
| 미성년자 계정 | 법적 요구사항에 따라 처리 (추가 검토 필요) |
| 계정 양도 요청 | 원칙적으로 불가 (정책 정의 필요) |

---

## 8. 미결정 쟁점

| 항목 | 상태 | 비고 |
|------|------|------|
| Steam 로그인 시 받아올 수 있는 데이터 범위 | 📋 확인 필요 | Steam Web API 검토 |
| 계정 양도 정책 | 📋 논의 필요 | - |
| 미성년자 계정 정책 | 📋 논의 필요 | 법적 검토 필요 |
| CS 본인 확인 절차 | 📋 정의 필요 | - |
| 다중 기기 로그인 정책 | 📋 논의 필요 | 동시 로그인 허용 vs 기존 세션 만료 |
| Refresh Token 만료 기간 | 📋 미확정 | 7일 vs 30일 |
| Tenant 전환 기능 범위 | 📋 미확정 | 개인 사용자는 단일 Tenant, 기업 사용자는 복수 |

---

## 9. 향후 확장 가능성

| 항목 | 설명 | 우선순위 |
|------|------|---------|
| **Steam 로그인 구현** | Steam Web API 연동 | 높음 |
| **Google OAuth** | Google 계정 로그인 | 중간 |
| **2단계 인증** | OTP 또는 인증 앱 | 낮음 |

---

## 관련 문서

- [보안 시스템](./03_Security.md)
- [라이선스 체계](./02_License_System.md)
- [데이터 생명주기](./04_Data_Lifecycle.md)
- [사용자 역할](./01_User_Roles.md)
