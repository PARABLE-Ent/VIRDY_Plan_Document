# 비용 분석 및 수익성

> **문서 버전**: 1.0
> **최종 수정일**: 26.02.02 22:30
> **작성자**: 임경섭

---

## 1. 개요

VIRDY의 비용 구조는 **로컬 퍼스트 아키텍처**를 기반으로 설계되어, 전통적인 클라우드 기반 솔루션 대비 **네트워크 전송 비용을 99% 절감**하는 것을 목표로 한다. 이 문서는 실제 운영 시 발생하는 비용을 사용자 플랜별로 분석하고, 수익성과 손익분기점을 산출한다.

### 1.1 비용 산출 전제 조건

| 항목 | 설명 |
|------|------|
| **비용 산정 원칙** | 최악의 경우(Worst Case)를 기준으로 산정 |
| **플랜 구조** | Free / Starter / Pro / Studio / Enterprise (5단계) |
| **가격 정책** | Steam 수수료 30% 반영 |
| **환율** | 원화 기준 (USD 환산 시 별도 명시) |

### 1.2 비용 구성 요소 개요

| 구성 요소 | 역할 | 비용 발생 시점 |
|----------|------|--------------|
| **GCP Cloud Run** | Spring Boot API 서버 | 항상 |
| **PostgreSQL (GCP)** | 사용자/세션 데이터 | 항상 |
| **Cloudflare R2** | 아바타/월드 스토리지 | 업로드/다운로드 시 |
| **Firebase Auth** | 사용자 인증 | 로그인 시 |
| **Photon Fusion** | 실시간 네트워크 동기화 | 세션(합방) 시 |

---

## 2. 비용 구성 요소 상세

### 2.1 인프라 비용 (GCP/R2/Firebase)

#### GCP Cloud Run (Spring Boot API)

| 항목 | 사양 | 월 예상 비용 |
|------|------|------------|
| vCPU | 1 core | ~50,000원 |
| Memory | 2GB | ~30,000원 |
| Request | 1M requests/월 | ~20,000원 |
| **합계** | - | **~100,000원** |

#### PostgreSQL (GCP Cloud SQL)

| 항목 | 사양 | 월 예상 비용 |
|------|------|------------|
| Instance | db-f1-micro | ~30,000원 |
| Storage | 10GB SSD | ~10,000원 |
| **합계** | - | **~40,000원** |

#### Cloudflare R2 (S3 호환 스토리지)

| 항목 | 단가 | 비고 |
|------|------|------|
| 저장 용량 | $0.015/GB/월 | ~20원/GB/월 |
| Class A 작업 (업로드) | $4.50/1M requests | ~6,000원/1M |
| Class B 작업 (다운로드) | $0.36/1M requests | ~500원/1M |
| **전송료 (Egress)** | **무료** | ✅ 핵심 절감 요소 |

**사용자별 R2 비용 추정:**

| 플랜 | 저장 용량 | 월 비용 |
|------|----------|---------|
| Free | 로컬만 | 0원 |
| Starter | 5GB | ~100원 |
| Pro | 50GB | ~1,000원 |
| Studio | 200GB | ~4,000원 |

#### Firebase Authentication

| 항목 | 무료 한도 | 초과 시 |
|------|----------|---------|
| 인증 요청 | 50,000/월 | $0.0055/인증 |
| **예상 비용** | - | **무료 한도 내** |

---

### 2.2 네트워크 비용 (Photon Fusion)

Photon Fusion은 **CCU(동시 접속자) 기반 요금제**를 사용한다.

#### Photon 요금제

| 플랜 | 월 비용 | CCU 한도 | 초과 시 |
|------|---------|----------|---------|
| Free | $0 | 20 CCU | 불가 |
| Photon 100 | $95 (~127,000원) | 100 CCU | $0.99/CCU |
| Photon 500 | $355 (~475,000원) | 500 CCU | $0.75/CCU |

#### 트래픽 기반 추가 비용

세션당 트래픽은 다음과 같이 계산된다:

```
트래픽(GB) = (인원 × Tickrate × 데이터 크기 × 시간) / 1024^3
```

**예시: 6인 풀방, 60Hz, 1시간**

| 항목 | 값 |
|------|-----|
| 동기화 데이터 | 본(22개) + 표정(100개) + 손가락(40개) ≈ 2KB/frame |
| Tickrate | 60Hz |
| 초당 전송량 | 2KB × 60 = 120KB/s |
| 6인 × 1시간 | 120KB × 6 × 3600s ≈ **2.5GB** |

**월 20시간 합방 시:**
- 트래픽: 2.5GB × 20h = **50GB**
- Photon 초과 요금 (100GB 무료 후): 없음

**Worst Case (720시간 풀방):**
- 트래픽: 2.5GB × 720h = **1,800GB**
- Photon 초과 요금: **폭주** 🚨

---

### 2.3 고정 비용 (서버 유지비)

| 항목 | 월 비용 |
|------|---------|
| GCP Cloud Run | ~100,000원 |
| PostgreSQL | ~40,000원 |
| 기타 (모니터링, 백업) | ~10,000원 |
| **합계** | **~150,000원** |

---

## 3. 사용자별 월간 원가

### 3.1 Light User (Starter 플랜)

**사용 패턴:**
- 아바타 3개 (5GB 저장)
- 월드 1개
- 합방 거의 안 함 (월 2시간 미만)

| 비용 항목 | 금액 |
|----------|------|
| R2 저장 | ~100원 |
| R2 다운로드 | ~20원 |
| Photon (거의 0) | ~5원 |
| **총 원가** | **~125원** |

---

### 3.2 Heavy User (Pro 플랜)

**사용 패턴:**
- 아바타 10개 (50GB 저장)
- 월드 5개
- 합방 월 20시간 (주 5시간)
- 6인 풀방 60Hz

| 비용 항목 | 금액 |
|----------|------|
| R2 저장 | ~1,000원 |
| R2 다운로드 | ~100원 |
| Photon 트래픽 (50GB) | ~3,500원 |
| **총 원가** | **~4,600원** |

---

### 3.3 Worst Case 시나리오

**극단적 악용 케이스:**
- 24시간 × 30일 = **720시간** 동안 6인 풀방 60Hz 유지
- 트래픽: 약 **1,800GB** 발생

| 비용 항목 | 금액 |
|----------|------|
| R2 저장 | ~10,000원 |
| R2 다운로드 | ~500원 |
| **Photon 트래픽** | **~141,500원** 🚨 |
| **총 원가** | **~152,000원** |

**대응 방안:**
- Session Timeout (4시간 자동 종료)
- 일 10GB 초과 시 알림 및 제한
- 약관에 비정상 사용 제재 명시

---

## 4. 플랜별 수익성 분석

### 4.1 가격 정책 (검토 중)

| 플랜 | 월 구독료 | 연간 구독료 | Steam 정산 후 | 타겟 |
|------|----------|------------|-------------|------|
| **Free** | 0원 | - | - | 입문자 |
| **Starter** | 3,900원 | 39,000원 (17% 할인) | ~2,730원 | 개인 방송 |
| **Pro** | 14,900원 | 149,000원 (17% 할인) | ~10,430원 | 고품질 합방 |
| **Studio** | 📋 미정 | 📋 미정 | 📋 미정 | 프로덕션 |
| **Enterprise** | 📋 협의 | 📋 협의 | 📋 협의 | 기업 |

> **주의:** Steam 수수료 30% 적용 기준. VAT 별도.

---

### 4.2 Starter 플랜 마진

| 항목 | 금액 |
|------|------|
| 구독료 (Steam 정산 후) | 2,730원 |
| 예상 원가 | -125원 |
| **순이익** | **2,605원** ✅ |
| **마진율** | **~95%** |

---

### 4.3 Pro 플랜 마진

| 항목 | 금액 |
|------|------|
| 구독료 (Steam 정산 후) | 10,430원 |
| 예상 원가 (월 20h 합방) | -4,600원 |
| **순이익** | **5,830원** ✅ |
| **마진율** | **~56%** |

---

### 4.4 Studio/Enterprise 플랜 (검토 중)

현재 가격 미정. 다음 요소를 고려하여 산정 필요:

| 고려 사항 | 내용 |
|----------|------|
| 아바타/월드 슬롯 | 대용량 스토리지 비용 |
| 동시 세션 수 | 3개 이상 동시 방 유지 시 Photon 비용 증가 |
| Ultra Sync 모드 | 고품질 동기화로 트래픽 2배 증가 가능 |
| 시트(Seat) 기반 | 팀원 수에 비례한 비용 구조 |

---

## 5. 손익분기점(BEP) 분석

### 5.1 고정비 추정

| 항목 | 월 비용 |
|------|---------|
| 서버 유지비 (GCP + DB) | ~150,000원 |
| 인건비 | (별도 산정) |
| 기타 운영비 | ~50,000원 |
| **합계** | **~200,000원** |

> **주의:** 인건비 제외 시 서버 운영비만 기준

---

### 5.2 BEP 달성 조건 (서버 비용 기준)

**목표:** 월 200,000원 고정비 회수

#### Case 1: Starter Only

```
필요 사용자 수 = 200,000원 / 2,605원 ≈ 77명
```

#### Case 2: Pro Only

```
필요 사용자 수 = 200,000원 / 5,830원 ≈ 35명
```

#### Case 3: Mixed (Starter 70% : Pro 30%)

```
평균 순이익 = (2,605 × 0.7) + (5,830 × 0.3) = 3,572원
필요 사용자 수 = 200,000원 / 3,572원 ≈ 56명
```

---

### 5.3 Photon CCU 고려

Photon Free 플랜(20 CCU)을 벗어나면:

| Photon 플랜 | 월 비용 | 필요 BEP |
|------------|---------|---------|
| Photon 100 | ~127,000원 | +49명 추가 |
| Photon 500 | ~475,000원 | +182명 추가 |

**결론:** 초기에는 Free 플랜(20 CCU) 내에서 운영하고, 점진적 확장 필요

---

## 6. 비용 방어 체계

### 6.1 5단계 방어 구조

#### 1차 방어: Config API 강제 제어

| 플랜 | Tickrate | Bone 수 | 제어 방법 |
|------|----------|---------|----------|
| Free | 20Hz | 15개 | 서버에서 강제 제한 |
| Starter | 30Hz | 22개 | Config API 응답 |
| Pro | 60Hz | 22개 | Config API 응답 |
| Enterprise | Ultra 모드 | 전체 | 별도 계약 |

**구현:**
- 클라이언트가 세션 시작 시 서버에 Config 요청
- 서버가 플랜에 따라 동적으로 제한값 응답
- 클라이언트는 서버 응답값으로만 동작

---

#### 2차 방어: Rate Limiting

| 대상 | 제한 |
|------|------|
| 아바타 업로드 | 5분당 1회 |
| 월드 업로드 | 10분당 1회 |
| API 요청 | 1,000회/분 |
| 세션 생성 | 플랜별 동시 제한 |

---

#### 3차 방어: Session Timeout

| 조건 | 동작 |
|------|------|
| 4시간 유지 | 자동 경고 |
| 유료 유저 0명 | 10분 유예 후 종료 |
| 호스트 이탈 | 10분 유예 + 자동 이전 |

---

#### 4차 방어: 트래픽 모니터링

| 조건 | 동작 |
|------|------|
| 일 10GB 초과 | 이메일 알림 |
| 월 300GB 초과 | 계정 제한 검토 |
| Worst Case 감지 | 강제 세션 종료 |

---

#### 5차 방어: 약관 및 제재

| 항목 | 내용 |
|------|------|
| 비정상 사용 정의 | 24시간 연속 세션, 매크로 의심 패턴 |
| 제재 수위 | 경고 → 일시 정지 → 영구 정지 |
| 환불 정책 | 약관 위반 시 환불 불가 |

---

### 6.2 기술적 제약 설계

| 제약 | 목적 | 구현 방법 |
|------|------|----------|
| **압축 기술** | 트래픽 1/10 축소 | Draco + KTX2 |
| **P2P 최적화** | 서버 부하 감소 | Photon Fusion Shared Mode |
| **Signed URL** | 직접 다운로드 | R2 egress 무료 활용 |
| **변경 감지** | 불필요한 전송 제거 | Delta Compression |

---

## 7. 시나리오별 비용 시뮬레이션

### 7.1 정상 사용 패턴

**시나리오:** Pro 플랜 사용자, 주 3회 합방 (각 2시간)

| 항목 | 값 |
|------|-----|
| 월 합방 시간 | 24시간 |
| 트래픽 | ~60GB |
| 원가 | ~5,000원 |
| 수익 | 10,430원 - 5,000원 = **5,430원** ✅ |

---

### 7.2 헤비 유저 패턴

**시나리오:** Pro 플랜, 매일 2시간 합방

| 항목 | 값 |
|------|-----|
| 월 합방 시간 | 60시간 |
| 트래픽 | ~150GB |
| 원가 | ~8,500원 |
| 수익 | 10,430원 - 8,500원 = **1,930원** ⚠️ |

**대응:** 세션 타임아웃 정책으로 제한

---

### 7.3 악용 패턴

**시나리오:** 24시간 연속 세션 유지 시도

| 항목 | 값 |
|------|-----|
| 의도 | 720시간 |
| **실제 (4시간 제한)** | **120시간** |
| 트래픽 | ~300GB (제한 적용) |
| 원가 | ~15,000원 |
| 수익 | 10,430원 - 15,000원 = **-4,570원** 🚨 |

**대응:**
- 4시간 세션 타임아웃
- 일 10GB 초과 알림
- 월 300GB 초과 시 계정 제한

---

## 8. 설계 시 고려사항

### 8.1 Steam 정산 수수료 (30%)

모든 가격에 Steam 수수료 30% 반영 필요:

| 표시 가격 | Steam 정산 후 |
|----------|-------------|
| 3,900원 | 2,730원 (30% 차감) |
| 14,900원 | 10,430원 (30% 차감) |

---

### 8.2 VAT 및 환율 변동

| 고려 사항 | 내용 |
|----------|------|
| VAT | 한국 10%, 지역별 상이 |
| 환율 변동 | USD 기반 Photon/GCP 비용 영향 |
| 리전별 차이 | Firebase Storage 다운로드 비용 차이 |

---

### 8.3 결제 시스템 미구현

향후 구현 필요:
- Stripe/Steam 결제 연동
- 구독 상태 관리
- 라이선스 검증
- 평가판 로직

---

## 9. 향후 검토 사항

| 항목 | 상태 | 우선순위 |
|------|------|---------|
| Studio/Enterprise 플랜 가격 확정 | 📋 논의 필요 | 높음 |
| Photon 비용 최적화 (Delta Sync) | 🚧 검토 중 | 높음 |
| Ultra Sync 모드 비용 산출 | 📋 미정 | 중간 |
| 마켓플레이스 수수료 정책 | 📋 미정 | 낮음 |
| 리전별 서버 증설 비용 | 📋 미정 | 낮음 |

---

## 10. 참고 자료

- **원본 산출 자료**: VIRDY 사업 종합 기획서 v1.0 (HTML, 박성술 작성)
- **라이선스 체계**: [라이선스 체계](./02_License_System.md)
- **리스크 관리**: [리스크 관리](./05_Risk_Management.md)
- **네트워크 시스템**: [네트워크 시스템](../02_Features/05_Network_System.md)
- **데이터 생명주기**: [데이터 생명주기](./04_Data_Lifecycle.md)

---

## 관련 문서

- [제품 개요](../01_Product/01_Product_Overview.md)
- [라이선스 체계](./02_License_System.md)
- [리스크 관리](./05_Risk_Management.md)
- [네트워크 시스템](../02_Features/05_Network_System.md)
